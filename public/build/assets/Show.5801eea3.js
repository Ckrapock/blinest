import{o as l,b as i,a as e,d as c,w,r as A,g as $,s as E,q as F,e as V,j as h,c as j,t as o,h as x,u as g,E as H,J as U,y as B,F as C,n as M,l as S,C as O,m as D,H as N}from"./app.2ccf841f.js";import{F as P}from"./LanguageSwitcher.cb537353.js";import"./_defineProperty.09f4b3d5.js";import{_ as q}from"./Navbar.f548c814.js";import{C as T}from"./Card.53d0f134.js";import{S as G}from"./Spinner.ad70554a.js";import{_ as R}from"./Modal.95e75e17.js";import{_ as L}from"./SelectInput.7600b19c.js";import{_ as I}from"./TextInput.c49deda3.js";import J from"./Player.29560e49.js";import K from"./UserInput.c9b2cbe5.js";import Q from"./Answers.d1cd2165.js";import W from"./Ranking.79324061.js";import X from"./FinishedRoundModal.34a6af30.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./Dropdown.6ea7b926.js";import"./Icon.6689216d.js";import"./pickBy.83d2d581.js";import"./debounce.1e54c607.js";import"./SocialIcon.895ec767.js";import"./Controls.47d260d9.js";import"./PodiumModal.5121460f.js";const Y={class:"text-neutral-200"},Z=e("div",{id:"dropdown"},null,-1),ee={class:"md:flex md:flex-col"},se={class:"md:flex md:h-screen md:flex-col"},te={class:"md:flex md:flex-grow md:overflow-hidden"},oe={key:0,class:"md:flex-1"},ne={__name:"RoomLayout",setup(s){return(m,a)=>(l(),i("div",Y,[Z,e("div",ee,[e("div",se,[c(q),e("div",te,[c(E,{name:"slide-right",appear:""},{default:w(()=>[m.$slots.default?(l(),i("div",oe,[c(P),A(m.$slots,"default")])):$("",!0)]),_:3})])])])]))}},le={class:"flex items-center justify-between w-full"},ae={class:"italic text-sm pr-2"},re={class:"my-2 border-l px-4 py-2 font-mono text-neutral-400"},ie={class:"mr-1 text-xs"},ue=e("br",null,null,-1),me={class:"my-4 flex items-center gap-4"},de={class:"p-4 text-sm m-4 border rounded"},ce={value:"+1 day"},he={value:"+1 week"},ve={value:"+1 month"},fe={value:null},_e=["value"],pe={__name:"Moderation",props:{message:Object,room:Object},emits:"close",setup(s,{emit:m}){const a=s,r=F({comment:"",expired_at:null});V().props.value.auth.user;const u=a.room.moderators.find(t=>t.id===a.message.user.id),v=h(!0),b=h(!1),f=["Pseudonyme inappropri\xE9.","Langage inappropri\xE9.","Propos injurieux, sexistes ou racistes.","Menace ou harc\xE8le d'autres joueurs.","Donne les r\xE9ponses dans le chat.","Utilise un nouveau compte alors que le joueur a d\xE9j\xE0 \xE9t\xE9 banni.","Troll, spam.","Triche."],_=()=>{axios.delete(`/moderation/messages/${a.message.id}`).then(t=>{y()})},p=()=>{r.post(`/moderation/users/${a.message.user.id}/ban`,{preserveScroll:!0,preserveState:!0,onSuccess:()=>{y()}})},y=()=>{m("close")};return(t,n)=>(l(),j(R,{show:v.value,onClose:y},{default:w(()=>[c(T,null,{header:w(()=>[e("div",le,[e("h2",null,o(t.__("Moderation")),1),e("span",ae,o(s.message.user.name),1)])]),default:w(()=>[e("blockquote",re,[e("time",ie,o(s.message.time),1),ue,x(" "+o(s.message.body),1)]),e("div",me,[e("button",{class:"btn-danger btn-sm",onClick:_},o(t.__("Delete message")),1),g(u)?$("",!0):(l(),i("button",{key:0,class:"btn-danger btn-sm",onClick:n[0]||(n[0]=d=>b.value=!b.value)},o(t.__("Ban"))+" "+o(s.message.user.name),1)),e("button",{class:"btn-secondary btn-sm",onClick:y},o(t.__("Cancel")),1)]),H(e("div",de,[c(L,{modelValue:g(r).expired_at,"onUpdate:modelValue":n[1]||(n[1]=d=>g(r).expired_at=d),class:"mb-2",label:t.__("Duration")},{default:w(()=>[e("option",ce,o(t.__("One day")),1),e("option",he,o(t.__("One week")),1),e("option",ve,o(t.__("One month")),1),e("option",fe,o(t.__("Unlimited")),1)]),_:1},8,["modelValue","label"]),c(L,{modelValue:g(r).comment,"onUpdate:modelValue":n[2]||(n[2]=d=>g(r).comment=d),label:t.__("Reason")},{default:w(()=>[(l(),i(C,null,B(f,d=>e("option",{value:d},o(t.__(d)),9,_e)),64))]),_:1},8,["modelValue","label"]),g(u)?$("",!0):(l(),i("button",{key:0,class:"btn-danger btn-sm my-4",onClick:p},o(t.__("Confirm and ban"))+" "+o(s.message.user.name),1))],512),[[U,b.value]])]),_:1})]),_:1},8,["show"]))}},ge={class:"group relative my-1 flex flex-wrap items-center text-sm hover:opacity-90"},we={key:0},xe=e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-4 h-4 animate-spin"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})],-1),be=[xe],$e={class:"text-yellow-600 mr-1"},ke={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"h-4 w-4 text-red-500"},ye=e("path",{"fill-rule":"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z","clip-rule":"evenodd"},null,-1),Me={class:"mr-2 text-xs italic text-neutral-500"},Ce=["src","alt"],je={key:0,class:"mx-1 text-[9px] uppercase"},Ve=["src","alt"],Be={key:0,class:"mx-1 text-[9px] uppercase"},Se={class:""},Te={__name:"Message",props:{room:Object,message:Object},setup(s){const m=s,a=h(!1),r=h(!1),u=V().props.value.auth.user,v=m.room.moderators.find(f=>f.id===u.id),b=()=>{r.value=!0,axios.post(`/rooms/${m.room.id}/message/${m.message.id}/report`).then(f=>{r.value=!1})};return(f,_)=>(l(),i("div",ge,[e("div",{class:M(["absolute top-0 right-0 items-center group-hover:flex bg-neutral-800 py-1 px-2",s.message.reports<0?"flex":"hidden"])},[r.value?(l(),i("div",we,be)):(l(),i("button",{key:1,onClick:b,class:"text-xs flex items-center"},[e("span",$e,o(s.message.reports),1),(l(),i("svg",ke,[e("title",null,o(f.__("Report this message")),1),ye]))]))],2),e("time",Me,o(s.message.time),1),g(v)?(l(),i("button",{key:0,onClick:_[0]||(_[0]=p=>a.value=!0),class:M(["mr-1 flex items-center",s.room.moderators.find(p=>p.id===s.message.user.id)?"text-purple-500":"text-neutral-400"])},[e("img",{src:s.message.user.photo,alt:s.message.user.name,class:"mr-1 h-6 w-6 rounded-full"},null,8,Ce),x(" "+o(s.message.user.name)+" ",1),g(u).team?(l(),i("sup",je,"["+o(g(u).team.name)+"]",1)):$("",!0),x(" : ")],2)):(l(),i("span",{key:1,class:M(["mr-1 flex items-center",s.room.moderators.find(p=>p.id===s.message.user.id)?"text-purple-500":"text-neutral-400"])},[e("img",{src:s.message.user.photo,alt:s.message.user.name,class:"mr-1 h-6 w-6 rounded-full"},null,8,Ve),x(" "+o(s.message.user.name)+" ",1),g(u).team?(l(),i("sup",Be,"["+o(g(u).team.name)+"]",1)):$("",!0),x(" : ")],2)),e("span",Se,o(s.message.body),1),a.value?(l(),j(pe,{key:2,message:s.message,room:s.room,onClose:_[1]||(_[1]=p=>a.value=!1)},null,8,["message","room"])):$("",!0)]))}},Le={class:"flex h-full flex-col"},Ee={class:"flex justify-center px-2 py-4"},Oe=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})],-1),Re={key:1,class:"flex items-center text-green-500"},ze=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})],-1),Ae={class:"flex p-2"},Fe=["onSubmit"],He={type:"submit",class:"rounded-r bg-teal-600 p-2 text-neutral-100"},Ue={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},De=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"},null,-1),Ne={__name:"Chat",props:{room:Object},setup(s){const m=s,a=`chat-room.${m.room.id}`,r=h(""),u=h(m.room.latest_messages);V().props.value.auth.user;const v=h(),b=h(null);S(()=>{Echo.private(a).listen("NewMessage",t=>{u.value.unshift(t.message),p()}).listen("MessageReported",t=>{u.value=u.value.map(n=>n.id===t.message.id?t.message:n)}).listen("MessageDeleted",t=>{u.value=u.value.filter(n=>n.id!=t.message.id)})}),O(()=>{Echo.leave(a)});const f=()=>{axios.post(`/rooms/${m.room.id}/alert`).then(t=>{b.value=!0})},_=()=>{axios.post(`/rooms/${m.room.id}/message`,{body:r.value}).then(t=>{r.value=""})},p=()=>{let t=v.value;t.scrollTop=t.scrollHeight+1e3},y=t=>{console.log(t)};return(t,n)=>(l(),i("div",Le,[e("div",Ee,[b.value?(l(),i("div",Re,[ze,x(" "+o(t.__("Alert sent")),1)])):(l(),i("button",{key:0,class:"btn-secondary btn-sm bg-neutral-700",onClick:f},[Oe,x(" "+o(t.__("Alerting moderators")),1)]))]),e("div",{ref_key:"messenger",ref:v,class:"flex flex-1 flex-col-reverse overflow-y-scroll p-2"},[(l(!0),i(C,null,B(u.value,d=>(l(),j(Te,{key:d.id,message:d,room:s.room,onModerate:y},null,8,["message","room"]))),128))],512),e("div",Ae,[e("form",{onSubmit:D(_,["prevent"]),class:"flex"},[c(I,{modelValue:r.value,"onUpdate:modelValue":n[0]||(n[0]=d=>r.value=d),autocomplete:"off",inputClass:"rounded-r-none border-0"},null,8,["modelValue"]),e("button",He,[(l(),i("svg",Ue,[e("title",null,o(t.__("Send")),1),De]))])],40,Fe)])]))}},Pe=e("h3",{class:"flex items-center pl-4 text-xl font-bold"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mr-2 h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"})]),x(" Autoriser la lecture ")],-1),qe={class:"p-4"},Ge={class:"mt-4 flex items-start text-sm text-neutral-400 bg-neutral-200 p-2 rounded"},Ie=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mr-2 h-10 w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})],-1),Je={class:"mt-8 flex justify-end"},Ke={__name:"UserGestureModal",setup(s){const m=h(!1);return S(()=>{var a=!0,r=document.createElement("audio").play();r instanceof Promise&&r.catch(function(u){if(u.name=="NotAllowedError")a=!1;else throw u}).then(function(){a||(m.value=!0)})}),(a,r)=>(l(),j(R,{show:m.value,onClose:r[1]||(r[1]=u=>m.value=!1)},{default:w(()=>[c(T,null,{header:w(()=>[Pe]),default:w(()=>[e("div",qe,[x(o(a.__("The browser needs your permission to start playing audio files."))+" ",1),e("p",Ge,[Ie,e("span",null,o(a.__("This message will appear every time you go directly to a room without going through the homepage.")),1)]),e("div",Je,[e("button",{class:"btn-primary",onClick:r[0]||(r[0]=u=>m.value=!1)},o(a.__("Let's go!")),1)])])]),_:1})]),_:1},8,["show"]))}},Qe={key:0,class:"flex h-full w-full items-center justify-center"},We={key:0,class:"h-full md:flex"},Xe={class:"relative flex-1 overflow-y-auto p-4 md:px-12 md:py-8","scroll-region":""},Ye={class:"mb-4 flex items-center"},Ze={class:"mr-8 text-xl font-bold"},es={class:"mb-4 md:mb-8"},ss={class:"grid md:grid-cols-2 md:gap-8"},ts={class:"flex items-center justify-between px-4 text-sm"},os={class:"mx-auto flex flex-wrap items-center gap-4"},ns=e("span",{class:"uppercase text-neutral-500"},"Modos",-1),ls=["src","alt","title"],as=e("div",{class:"flex items-center"},[e("button",{class:"btn-secondary bg-neutral-900 btn-sm"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"mr-1 h-5 w-5"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.383a14.406 14.406 0 01-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 10-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})]),x(" Envoyer une suggestion ")])],-1),rs=["title"],is=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),us=[is],ms={key:0,class:"flex h-96 w-full flex-shrink-0 flex-col rounded-tl border-neutral-700 bg-neutral-800 transition-all duration-300 md:h-full md:w-1/5"},Es={__name:"Show",props:{room:Object},setup(s){const m=s,a=`rooms.${m.room.id}`,r=h(null),u=h(!1),v=h(null),b=h(null),f=h(!1),_=h(!0),p=h(0);S(()=>{Echo.join(a).here(n=>{v.value=n,y()}).joining(n=>{v.value.push(n)}).leaving(n=>{v.value=v.value.filter(d=>d.id!==n.id)}).error(n=>{console.error(n)})}),O(()=>{Echo.leave(a)});const y=()=>{axios.get(`/rooms/${m.room.id}/joined`).then(()=>{u.value=!0,t()})},t=()=>{Echo.channel(a).listen("RoundStarted",n=>{console.warn("Round started"),r.value=n.round,f.value=!1}).listen("RoundFinished",n=>{console.warn("Round finished"),r.value=null,f.value=!0}).listen("TrackPlayed",n=>{r.value=n.round,m.room.value=n.room})};return(n,d)=>(l(),i(C,null,[c(g(N),{title:s.room.name},null,8,["title"]),c(ne,null,{default:w(()=>[u.value?$("",!0):(l(),i("div",Qe,[c(G),e("h2",null,o(n.__("Loading"))+"...",1)])),c(E,{name:"slide-right"},{default:w(()=>[u.value?(l(),i("div",We,[e("div",Xe,[e("article",Ye,[e("h2",Ze,o(s.room.name),1)]),e("div",es,[c(J,{room:s.room,channel:a,"onTrack:currentTime":d[0]||(d[0]=k=>p.value=k)},null,8,["room"]),c(K,{channel:a,currentTime:p.value,room:s.room},null,8,["currentTime","room"])]),e("div",ss,[c(Q,{class:"mb-4 md:mb-8",users:v.value,channel:a},null,8,["users"]),c(W,{class:"mb-4 md:mb-8",room:s.room,users:v.value,channel:a,data:b.value},null,8,["room","users","data"])]),c(T,null,{default:w(()=>[e("div",ts,[e("div",null,[e("div",os,[ns,(l(!0),i(C,null,B(s.room.moderators,k=>(l(),i("span",{class:M(["flex items-center",{"font-bold text-teal-500":v.value.find(z=>k.id===z.id)}])},[e("img",{src:k.photo,alt:k.name,title:k.name,class:"mr-1 h-8 w-8 rounded-full"},null,8,ls),x(" "+o(k.name),1)],2))),256))])]),as])]),_:1}),s.room.is_chat_active?(l(),i("button",{key:0,class:"absolute right-0 top-5 hidden rounded-l-lg bg-neutral-800 p-2 md:block",onClick:d[1]||(d[1]=k=>_.value=!_.value),title:n.__("Hide/Show chatbox")},us,8,rs)):$("",!0)]),_.value&&s.room.is_chat_active?(l(),i("div",ms,[c(Ne,{room:s.room},null,8,["room"])])):$("",!0)])):$("",!0)]),_:1}),c(X,{show:f.value,onClose:d[2]||(d[2]=k=>f.value=!1)},null,8,["show"]),c(Ke)]),_:1})],64))}};export{Es as default};

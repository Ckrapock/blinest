import{q as N,o as s,c as $,w as v,a as e,b as l,t as a,d as m,y as V,F as A,u as _,n as O,g as S,m as P,j as w,C as z,k as U,x as B,h as j,L as H}from"./app.2ccf841f.js";import{_ as C}from"./Icon.6689216d.js";import{C as T}from"./Card.53d0f134.js";import{_ as M}from"./TextInput.c49deda3.js";import{_ as W}from"./Pagination.535567c1.js";import{_ as q}from"./Modal.95e75e17.js";import{_ as G}from"./SelectInput.7600b19c.js";import{S as J}from"./Spinner.ad70554a.js";import{_ as E}from"./Dropdown.6ea7b926.js";import{t as K,p as Q}from"./pickBy.83d2d581.js";import{d as R}from"./debounce.1e54c607.js";const X=["onSubmit"],Y={class:"px-6 py-4"},Z={key:0,class:"text-lg"},ee={key:1,class:"text-lg"},se={class:"mt-4 flex flex-wrap"},te=["value"],le={class:"flex items-center justify-between px-2 py-4 text-right"},ae=["disabled"],oe={class:"flex items-center"},re=["disabled"],ne=["disabled"],ie={__name:"TrackAnswerForm",props:{answer:{type:Object,default(){return{answer_type_id:1,value:"",score:"0.5"}}},show:[Boolean,Number],maxWidth:{type:String,default:"2xl"},closeable:{type:Boolean,default:!0},answer_types:Object},emits:["close"],setup(o,{emit:h}){const r=o,t=N({answer_type_id:r.answer?r.answer.answer_type_id:1,value:r.answer?r.answer.value:"",score:r.answer?r.answer.score:.5}),p=()=>{h("close")},b=()=>{var i;(i=t==null?void 0:t.value)!=null&&i.id?f():k()},f=()=>{t.put(route("tracks.answers.update",[r.show,r.answer.id]),{preserveScroll:!0,preserveState:!1,onSuccess:()=>{p()}})},k=()=>{t.post(route("tracks.answers.store",r.show),{preserveScroll:!0,preserveState:!1,onSuccess:()=>{p()}})},u=()=>{t.delete(route("tracks.answers.delete",[r.show,r.answer.id]),{preserveScroll:!0,preserveState:!1,onSuccess:()=>{p()}})};return(i,d)=>(s(),$(q,{show:o.show,"max-width":o.maxWidth,closeable:o.closeable,onClose:p},{default:v(()=>[e("form",{onSubmit:P(b,["prevent"])},[e("div",Y,[o.answer?(s(),l("div",Z,a(i.__("Edit Answer")),1)):(s(),l("div",ee,a(i.__("Add Answer")),1)),e("div",se,[m(G,{modelValue:_(t).answer_type_id,"onUpdate:modelValue":d[0]||(d[0]=y=>_(t).answer_type_id=y),error:_(t).errors.answer_type_id,class:"w-full pb-8 pr-6 lg:w-1/2",label:i.__("Type")},{default:v(()=>[(s(!0),l(A,null,V(o.answer_types,y=>(s(),l("option",{value:y.id},a(i.__(y.name)),9,te))),256))]),_:1},8,["modelValue","error","label"]),m(M,{modelValue:_(t).score,"onUpdate:modelValue":d[1]||(d[1]=y=>_(t).score=y),type:"number",step:"0.5",min:"0",max:"99",error:_(t).errors.score,class:"w-full pb-8 pr-6 lg:w-1/2",label:i.__("Score")},null,8,["modelValue","error","label"]),m(M,{modelValue:_(t).value,"onUpdate:modelValue":d[2]||(d[2]=y=>_(t).value=y),error:_(t).errors.value,class:"w-full pb-8 pr-6",label:i.__("Answer")},null,8,["modelValue","error","label"])])]),e("div",le,[o.answer&&o.answer.id?(s(),l("button",{key:0,type:"button",class:O(["mx-2 text-red-400",{"opacity-25":_(t).processing}]),disabled:_(t).processing,onClick:u},a(i.__("Delete")),11,ae)):S("",!0),e("div",oe,[e("button",{class:"btn-secondary mx-2 bg-gray-400",onClick:p},a(i.__("Close")),1),o.answer&&o.answer.id?(s(),l("button",{key:0,type:"submit",class:O(["btn-primary ml-2",{"opacity-25":_(t).processing}]),disabled:_(t).processing},a(i.__("Update")),11,re)):(s(),l("button",{key:1,type:"submit",class:O(["btn-primary ml-2",{"opacity-25":_(t).processing}]),disabled:_(t).processing},a(i.__("Add")),11,ne))])])],40,X)]),_:1},8,["show","max-width","closeable"]))}},de={key:1,class:"mr-2 flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-neutral-800"},L={__name:"MiniPlayer",props:{track:Object},setup(o){const h=o,r=new Audio,t=w(!1),p=w(!1);z(()=>{f()});const b=()=>{t.value=!0,p.value=!0,r.src=h.track.preview_url,r.addEventListener("canplaythrough",()=>{t.value=!1,r.play()})},f=()=>{p.value=!1,r.pause()};return(k,u)=>p.value?t.value?(s(),l("div",de,[m(J,{class:"h-full w-full"})])):(s(),$(C,{key:2,name:"stop",class:"mr-2 h-12 w-12 flex-shrink-0 cursor-pointer",onClick:f})):(s(),$(C,{key:0,name:"play",class:"mr-2 h-12 w-12 flex-shrink-0 cursor-pointer",onClick:b}))}},ce={class:"flex w-full items-center justify-between"},ue={class:"text-xl font-bold"},pe={class:"mb-4 flex flex-wrap gap-2 p-2"},_e={key:0,class:"max-w-50 max-h-80 overflow-y-auto"},me={class:"relative cursor-pointer border-b border-neutral-200 px-1 py-2 hover:bg-neutral-100 hover:text-neutral-900"},he={class:"flex items-center"},fe={class:"mr-2 flex w-80 flex-1 flex-col"},ve={class:"max-w-[16rem] truncate break-normal font-bold"},ye={class:"max-w-[16rem] truncate break-normal text-sm"},we={key:0,class:"ml-auto"},be=["disabled","onClick"],ke={key:1,class:"ml-auto"},xe=["disabled","onClick"],ge={key:0,class:"mx-4 overflow-x-auto"},$e={class:"w-full whitespace-nowrap"},Ce={class:"text-left font-bold"},Se=e("th",{class:"px-6 pb-4 pt-6",colspan:"2"},null,-1),Ve={class:"px-6 pb-4 pt-6"},Ae={class:"px-6 pb-4 pt-6",colspan:"2"},je={class:"px-6 pb-4 pt-6",colspan:"2"},Me={class:"border-t"},Oe=["href"],Be={class:"border-t"},Ue={class:"flex items-center justify-center px-2 py-4 focus:text-blinest-500"},Ne={class:"border-t"},Te={class:"flex flex-col items-start px-6 py-4 text-sm focus:text-blinest-500"},Fe=["onClick"],Le={class:"font-bold"},Ee=["onClick"],Re={class:"border-t"},De={class:"flex items-start px-6 py-4 text-center text-sm"},Ie={class:"border-t"},Pe={class:"flex items-start px-6 py-4 text-center text-sm focus:text-blinest-500"},ze={class:"border-t"},He={class:"flex flex-col items-start px-6 py-4 text-sm focus:text-blinest-500"},We={class:"border-t"},qe={key:0},Ge={class:"border-t px-6 py-4",colspan:"4"},Je={key:1,class:"p-2"},ks={__name:"TracksManager",props:{playlist:Object,answer_types:Object,tracks:Object,filters:{type:Object,default:{search:""}}},setup(o){const h=o,r=N({search:h.filters.search}),t=w(null),p=w(!1),b=w(!1),f=w("");w("");const k=w(!1),u=w([]);U(f,R(()=>{i()},300)),U(r,K(()=>{B.Inertia.get(route("playlists.edit",h.playlist),Q(r),{preserveScroll:!0,preserveState:!0})},150),{deep:!0});const i=()=>{f.value.length>1?(k.value=!0,axios.get(route("tracks.search",h.playlist.id)+"?term="+f.value).then(c=>{u.value=c.data.tracks,k.value=!1})):u.value=[]},d=c=>{p.value=c.id},y=(c,x=null)=>{t.value=x,b.value=c.id},D=()=>{p.value=!1,b.value=!1},I=c=>{B.Inertia.post(route("playlists.tracks.store",h.playlist.id),c,{preserveScroll:!0,preserveState:!0,onSuccess:()=>{i()}})},F=c=>{let x=c.added?c.added.id:c.id;B.Inertia.delete(route("tracks.delete",x),{preserveScroll:!0,preserveState:!0,onSuccess:()=>{i()}})};return(c,x)=>(s(),$(T,null,{header:v(()=>[e("div",ce,[e("h3",ue,a(c.__("Tracks manager"))+" ("+a(o.tracks.total)+")",1),m(M,{modelValue:_(r).search,"onUpdate:modelValue":x[0]||(x[0]=n=>_(r).search=n),"prepend-icon":"search",placeholder:c.__("Search in playlist")+"..."},null,8,["modelValue","placeholder"])])]),default:v(()=>[e("div",null,[e("div",pe,[m(E,{placement:"bottom-start","auto-close":!1,onClosed:x[2]||(x[2]=n=>f.value="")},{default:v(()=>[m(M,{modelValue:f.value,"onUpdate:modelValue":x[1]||(x[1]=n=>f.value=n),"prepend-icon":"plus","append-icon":"cheveron-down",loading:k.value,placeholder:c.__("Search on Deezer, Spotify and Apple music...")},null,8,["modelValue","loading","placeholder"])]),dropdown:v(()=>[u.value.length?(s(),l("ul",_e,[(s(!0),l(A,null,V(u.value,n=>(s(),l("li",me,[e("div",he,[e("div",null,[m(C,{name:n.provider,title:n.provider,class:"mr-2 h-6 w-6 flex-shrink-0"},null,8,["name","title"])]),e("div",null,[(s(),$(L,{key:`mini-player-results-${n.id}`,track:n},null,8,["track"]))]),e("div",fe,[e("span",ve,a(n.artist_name),1),e("span",ye,a(n.track_name),1)]),n.added?(s(),l("div",ke,[e("button",{disabled:k.value,class:"btn-danger",type:"button",onClick:g=>F(n)},a(c.__("Remove")),9,xe)])):(s(),l("div",we,[e("button",{disabled:k.value,class:"btn-primary",type:"button",onClick:g=>I(n)},a(c.__("Add")),9,be)]))])]))),256))])):S("",!0)]),_:1})]),o.tracks.data.length?(s(),l("div",ge,[e("table",$e,[e("tr",Ce,[Se,e("th",Ve,a(c.__("Answers")),1),e("th",Ae,a(c.__("Votes")),1),e("th",je,a(c.__("Created at")),1)]),(s(!0),l(A,null,V(o.tracks.data,n=>(s(),l("tr",{key:n.id},[e("td",Me,[e("a",{target:"_blank",href:n.provider_url,class:"flex items-center justify-center px-2 py-4 focus:text-blinest-500"},[m(C,{name:n.provider,title:n.provider,class:"mr-2 h-6 w-6 flex-shrink-0"},null,8,["name","title"])],8,Oe)]),e("td",Be,[e("div",Ue,[(s(),$(L,{key:`mini-player-list-${n.id}`,track:n},null,8,["track"]))])]),e("td",Ne,[e("div",Te,[(s(!0),l(A,null,V(n.answers,g=>(s(),l("div",{key:g.id,class:"cursor-pointer whitespace-normal break-words",onClick:ds=>y(n,g)},[e("span",Le,a(c.__(g.type.name))+":",1),j(" "+a(g.value)+" ("+a(g.score)+"pts) ",1)],8,Fe))),128)),e("button",{class:"text-neutral-400",onClick:g=>d(n)},[m(C,{name:"plus",class:"inline-block h-4 w-4 flex-shrink-0 fill-neutral-400"}),j(a(c.__("Add an answer")),1)],8,Ee)])]),e("td",Re,[e("div",De,[m(C,{name:"thumb-up",class:"mr-2 h-6 w-6 flex-shrink-0"}),j(" "+a(n.up_votes),1)])]),e("td",Ie,[e("div",Pe,[m(C,{name:"thumb-down",class:"mr-2 h-6 w-6 flex-shrink-0"}),j(" "+a(n.down_votes),1)])]),e("td",ze,[e("div",He,a(n.created_at),1)]),e("td",We,[m(C,{name:"delete",class:"mr-2 h-6 w-6 flex-shrink-0 cursor-pointer fill-red-400",onClick:g=>F(n)},null,8,["onClick"])])]))),128)),o.tracks.length===0?(s(),l("tr",qe,[e("td",Ge,a(c.__("No tracks found"))+".",1)])):S("",!0)])])):(s(),l("div",Je,a(c.__("Aucun extrait")),1)),m(W,{class:"p-8",links:o.tracks.links},null,8,["links"]),p.value||b.value&&t.value?(s(),$(ie,{key:2,answer:t.value,answer_types:o.answer_types,show:b.value||p.value,"max-width":"md",onClose:D},null,8,["answer","answer_types","show"])):S("",!0)])]),_:1}))}},Ke={class:"text-xl font-bold"},Qe={key:0,class:"max-w-50 max-h-80 overflow-y-auto"},Xe=["src"],Ye={class:"mr-4"},Ze=["title","onClick"],es={key:0},ss=["src"],ts=["title","onClick"],ls=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})],-1),as=[ls],os={key:1,class:"my-2 text-sm text-neutral-400"},xs={__name:"ModeratorsManager",props:{playlist:Object},setup(o){const h=o,r=w(""),t=w(!1),p=w(null),b=N({user_id:null});U(r,R(()=>{t.value=!0,axios.get("/api/users",{params:{search:r.value}}).then(u=>{p.value=u.data.users,t.value=!1})},300));const f=u=>{b.transform(i=>({user_id:u.id})).post(`/playlists/${h.playlist.id}/moderators/attach`,{preserveScroll:!0})},k=u=>{b.transform(i=>({user_id:u.id})).delete(`/playlists/${h.playlist.id}/moderators/detach`,{preserveScroll:!0})};return(u,i)=>(s(),$(T,null,{header:v(()=>[e("h3",Ke,a(u.__("Moderators")),1)]),default:v(()=>[m(E,{placement:"bottom-start",class:"mb-2 pb-2",onClosed:i[1]||(i[1]=d=>r.value="")},{default:v(()=>[m(M,{modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=d=>r.value=d),"prepend-icon":"search","append-icon":"cheveron-down",loading:t.value,placeholder:u.__("Add a moderator")},null,8,["modelValue","loading","placeholder"])]),dropdown:v(()=>[p.value&&p.value.data.length?(s(),l("ul",Qe,[(s(!0),l(A,null,V(p.value.data,d=>(s(),l("li",{key:d.id,class:"flex items-center p-2"},[d.photo?(s(),l("img",{key:0,class:"-my-2 mr-2 block h-8 w-8 rounded-full",src:d.photo},null,8,Xe)):S("",!0),e("span",Ye,a(d.name),1),e("button",{class:"ml-auto rounded-full bg-blue-500 py-1 px-2 text-xs uppercase",title:u.__("Add"),onClick:y=>f(d)},a(u.__("Add")),9,Ze)]))),128))])):S("",!0)]),_:1}),o.playlist.moderators.length?(s(),l("ul",es,[(s(!0),l(A,null,V(o.playlist.moderators,d=>(s(),l("li",{key:d.id,class:"flex items-center rounded p-3"},[d.photo?(s(),l("img",{key:0,class:"-my-2 mr-2 block h-8 w-8 rounded-full",src:d.photo},null,8,ss)):S("",!0),j(" "+a(d.name)+" ",1),d.id!=o.playlist.user_id?(s(),l("button",{key:1,class:"ml-auto text-red-500",title:u.__("Remove"),onClick:y=>k(d)},as,8,ts)):S("",!0)]))),128))])):(s(),l("p",os,a(u.__("No moderator")),1))]),_:1}))}},rs={class:"text-xl font-bold"},ns={key:0},is={key:1,class:"my-2 text-sm text-neutral-400"},gs={__name:"RoomsList",props:{playlist:Object},setup(o){return(h,r)=>(s(),$(T,null,{header:v(()=>[e("h3",rs,a(h.__("Rooms")),1)]),default:v(()=>[o.playlist.rooms.length?(s(),l("ul",ns,[(s(!0),l(A,null,V(o.playlist.rooms,t=>(s(),l("li",{key:t.id,class:"flex items-center rounded p-3 hover:bg-neutral-200"},[m(_(H),{href:h.route("rooms.show",t.id)},{default:v(()=>[j(a(t.name),1)]),_:2},1032,["href"])]))),128))])):(s(),l("p",is,a(h.__("Empty")),1))]),_:1}))}};export{xs as _,gs as a,ks as b};

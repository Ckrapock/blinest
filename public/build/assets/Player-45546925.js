import{k as o,q as T,o as n,h as P,w as g,a as E,b as t,d as y,t as d,L as $,c as i,_ as I,g as B,x as f,F as b,v as U}from"./app-d721267d.js";import{_ as V}from"./Modal-50313139.js";import{C as z}from"./Card-73e0c1e9.js";import"./_plugin-vue_export-helper-c27b6911.js";const G=t("h3",{class:"flex items-center pl-4 text-xl font-bold"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mr-2 h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"})]),y(" Autoriser la lecture ")],-1),N={class:"p-4"},O={class:"mt-4 flex items-start text-sm text-neutral-400 bg-neutral-200 p-2 rounded"},F=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mr-2 h-10 w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})],-1),H={class:"mt-8 flex justify-end"},q={__name:"UserGestureModal",emits:["play"],setup(x,{emit:c}){const a=o(!1),e=()=>{c("play"),a.value=!1};return T(()=>{var s=!0,l=document.createElement("audio").play();l instanceof Promise&&l.catch(function(u){if(u.name=="NotAllowedError")s=!1;else throw u}).then(function(){s||(a.value=!0)})}),(s,l)=>(n(),P(V,{show:a.value,onClose:l[0]||(l[0]=u=>a.value=!1)},{default:g(()=>[E(z,null,{header:g(()=>[G]),default:g(()=>[t("div",N,[y(d(s.__("The browser needs your permission to start playing audio files."))+" ",1),t("p",O,[F,t("span",null,d(s.__("This message will appear every time you go directly to a room without going through the homepage.")),1)]),t("div",H,[t("button",{class:"btn-primary",onClick:e},d(s.__("Let's go!")),1)])])]),_:1})]),_:1},8,["show"]))}},D={id:"player",class:"relative flex h-4 w-full items-center rounded-t-lg bg-purple-200"},R=t("div",{class:"absolute left-1 top-full mt-1 h-full h-0 w-full w-0 translate-y-[-50%] border-t-[8px] border-l-[8px] border-r-[8px] border-t-transparent border-l-transparent border-r-transparent border-t-teal-600"},null,-1),W={key:1,class:"flex h-4 w-full animate-pulse items-center justify-center rounded-t-lg text-red-500"},J={key:2,class:"flex h-4 w-full max-w-full animate-pulse items-center justify-center rounded-t-lg bg-purple-500"},K={key:3,class:"flex max-w-full flex-grow flex-col"},Q={class:"relative flex h-6 w-full items-center overflow-hidden rounded-lg bg-purple-200"},X={class:"absolute left-0 right-0 top-0 bottom-0 flex items-center justify-center text-sm text-neutral-600"},Y={key:4,class:"w-full max-w-full"},re={__name:"Player",props:{room:Object,channel:String},emits:["track:played","track:ended","track:paused","track:stopped","track:currentTime"],setup(x,{emit:c}){const a=x,e=new Audio,s=o(null),l=o(!0),u=o(!1),m=o(null),_=o(0),v=o([]),A=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,p=o(0),h=o(!1),C=()=>{console.log("User Gesture"),e.play()};T(()=>{e.muted=!0,window.addEventListener("volume-localstorage-changed",r=>{e.volume=r.detail.volume}),Echo.channel(a.channel).listen("TrackPlayed",r=>{console.log("Track played"),s.value=r.track,L()}).listen("TrackEnded",r=>{console.log("Track ended"),v.value=[],w(),S()}).listen("TrackPaused",()=>{j()}).listen("TrackResumed",()=>{M()}).listen("UserHasFoundAllTheAnswers",r=>{v.value.push(r.user)})}),$(()=>{w(),Echo.leave(a.channel)});const L=()=>{u.value&&w(),l.value=!0,m.value=null,u.value=!0,e.src=s.value.preview_url,e.crossOrigin="anonymous",e.load(),e.muted=!1,e.addEventListener("error",()=>{m.value=e.error.message,u.value=!1}),e.addEventListener("canplaythrough",()=>{l.value=!1,A&&(console.log("iOS Player"),e.pause(),e.currentTime=0,e.volume=localStorage.getItem("volume")),e.play()}),e.addEventListener("timeupdate",()=>{c("track:currentTime",e.currentTime),_.value=parseInt(100/a.room.track_duration*(e.currentTime+.25))}),e.addEventListener("ended",()=>{u.value=!1,l.value=!0,c("track:ended",a.track)})},j=()=>{e.pause(),c("track:paused",a.track)},M=()=>{e.play()},w=()=>{e.pause(),c("track:stopped",a.track)},S=()=>{p.value=parseInt(a.room.pause_between_tracks),h.value=!0;let r=setInterval(()=>{p.value===-1?(clearInterval(r),h.value=!1):p.value--},1e3)};return(r,Z)=>(n(),i(b,null,[t("div",D,[v.value.length?(n(),P(I,{key:0,name:"list",tag:"ul"},{default:g(()=>[(n(!0),i(b,null,U(v.value,k=>(n(),i("li",{key:k.id,class:"absolute -top-8 z-20 rounded bg-teal-600 p-1 text-xs text-white",style:f("left:calc("+100/a.room.track_duration*k.time+"% - 0.25rem)")},[y(d(k.name)+" ",1),R],4))),128))]),_:1})):B("",!0),m.value?(n(),i("div",W,d(m.value),1)):l.value&&!h.value?(n(),i("div",J,d(r.__("Loading")),1)):h.value&&p.value!=-1?(n(),i("div",K,[t("div",Q,[t("div",{class:"flex h-6 items-center justify-center rounded-lg bg-gradient-to-br from-purple-300 to-purple-400 text-neutral-700 transition-all duration-1000 ease-linear",style:f("width:"+p.value/parseInt(a.room.pause_between_tracks)*100+"%")},[t("span",X,"Prochain extrait dans "+d(p.value),1)],4)])])):(n(),i("div",Y,[t("div",{class:"absolute top-0 left-0 z-10 h-4 rounded-r-lg rounded-tl-lg bg-gradient-to-br from-red-600 to-transparent transition-all duration-500 ease-linear",style:f("width:"+_.value+"%; max-width: 18%")},null,4),t("div",{class:"shine absolute h-4 rounded-r-lg rounded-tl-lg bg-gradient-to-br from-purple-300 to-purple-400 transition-all duration-500 ease-linear",style:f("width:"+_.value+"%")},null,4)]))]),E(q,{onPlay:C})],64))}};export{re as default};

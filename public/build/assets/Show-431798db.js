import{Q as I,o,c as i,a as c,w as x,b as e,t as l,u as r,X as P,r as q,g as _,R as L,F as S,J as j,k as f,h as C,d as y,I as U,N as J,f as B,P as Q,q as R,L as A,v as F,e as X}from"./app-f6824ecf.js";import{F as G}from"./LanguageSwitcher-d168d683.js";import"./isSymbol-363e1f0a.js";import"./_defineProperty-98183d58.js";import{_ as K}from"./Navbar-c61313dc.js";import{C as V}from"./Card-261bd2f6.js";import{S as W}from"./Spinner-7dbf9677.js";import{_ as O}from"./Modal-5b330035.js";import{_ as Y}from"./BanForm-9af547d5.js";import{T as z}from"./Tip-b30cc793.js";import{_ as Z}from"./TextareaInput-2b4b2789.js";import{_ as ee}from"./TextInput-4085333a.js";import{_ as E}from"./Share-45a2bb62.js";import te from"./Controls-f31fd89f.js";import se from"./Player-ea4f7bef.js";import oe from"./UserInput-dd2f054e.js";import ne from"./Answers-16b1f75a.js";import le from"./Ranking-d4c56059.js";import re from"./FinishedRoundModal-96b2aec5.js";import ae from"./SendSuggestionModal-f0d5f0ba.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./Dropdown-b8d92112.js";import"./Icon-1ce38a62.js";import"./throttle-b11e308e.js";import"./debounce-d2fd0fa0.js";import"./SocialIcon-b495e5c3.js";import"./SelectInput-aa3e4f90.js";import"./v4-cf522c50.js";import"./EditOptionsForm-32b781f5.js";import"./CheckboxInput-edaa6594.js";import"./LoadingButton-7c96c2e4.js";import"./PodiumModal-8ca13769.js";import"./Podium-72440200.js";const ie=["content"],me=["content"],ue=e("meta",{property:"og:type",content:"website"},null,-1),de=["content"],ce=["content"],he=["content"],fe=e("meta",{name:"twitter:card",content:"summary_large_image"},null,-1),ve=e("meta",{property:"twitter:domain",content:"blinest.com"},null,-1),pe=["content"],ge=["content"],_e=["content"],we=["content"],$e={class:"text-neutral-200"},xe=e("div",{id:"dropdown"},null,-1),be={class:"md:flex md:flex-col"},ke={class:"md:flex md:h-screen md:flex-col"},ye={class:"md:flex md:flex-grow md:overflow-hidden"},Me={key:0,class:"md:flex-1"},Ce={__name:"RoomLayout",setup(t){const n=I(()=>j().props.room);return(d,m)=>(o(),i(S,null,[c(r(P),null,{default:x(()=>[e("title",null,l(r(n).name),1),e("meta",{name:"description",content:r(n).description},null,8,ie),e("meta",{property:"og:url",content:r(n).url},null,8,me),ue,e("meta",{property:"og:image",content:r(n).photo_src?r(n).photo_src:r(n).photo},null,8,de),e("meta",{property:"og:title",content:r(n).name+" - Blinest.com"},null,8,ce),e("meta",{property:"og:description",content:r(n).description},null,8,he),fe,ve,e("meta",{property:"twitter:url",content:r(n).url},null,8,pe),e("meta",{name:"twitter:description",content:r(n).description},null,8,ge),e("meta",{name:"twitter:title",content:r(n).name+" - Blinest"},null,8,_e),e("meta",{name:"twitter:image",content:r(n).photo_src?r(n).photo_src:r(n).photo},null,8,we)]),_:1}),e("div",$e,[xe,e("div",be,[e("div",ke,[c(K),e("div",ye,[c(L,{name:"slide-right",appear:""},{default:x(()=>[d.$slots.default?(o(),i("div",Me,[c(G),q(d.$slots,"default")])):_("",!0)]),_:3})])])])])],64))}},je={class:"flex w-full items-center justify-between"},Be={class:"pr-2 text-sm italic"},Se={class:"my-2 border-l px-4 py-2 font-mono text-neutral-400"},Ve={class:"mr-1 text-xs"},Te=e("br",null,null,-1),Le={class:"my-4 flex items-center gap-4"},Re={__name:"Moderation",props:{message:Object,room:Object},emits:["close"],setup(t,{emit:n}){const d=t,m=j().props.auth.user,a=d.room.moderators.find(s=>s.id===d.message.user.id),b=j().props.publicModerators.find(s=>s.id===m.id),h=f(!0),g=f(!1),v=()=>{axios.delete(`/moderation/messages/${d.message.id}`).then(s=>{w()})},w=()=>{n("close")};return(s,p)=>(o(),C(O,{show:h.value,onClose:w},{default:x(()=>[c(V,null,{header:x(()=>[e("div",je,[e("h2",null,l(s.__("Moderation")),1),e("span",Be,l(t.message.user.name),1)])]),default:x(()=>[e("blockquote",Se,[e("time",Ve,l(t.message.time),1),Te,y(" "+l(t.message.body),1)]),e("div",Le,[e("button",{class:"btn-danger btn-sm",onClick:v},l(s.__("Delete message")),1),!r(a)&&r(b)?(o(),i("button",{key:0,class:"btn-danger btn-sm",onClick:p[0]||(p[0]=M=>g.value=!g.value)},l(s.__("Ban"))+" "+l(t.message.user.name),1)):_("",!0),e("button",{class:"btn-secondary btn-sm",onClick:w},l(s.__("Cancel")),1)]),U(c(Y,{user:t.message.user},null,8,["user"]),[[J,g.value]])]),_:1})]),_:1},8,["show"]))}},Ae={class:"group relative my-1 flex flex-wrap items-center text-sm hover:opacity-90"},Fe={key:0},Oe=e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4 animate-spin"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})],-1),ze=[Oe],Ee={class:"mr-1 text-yellow-600"},Ne={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"h-4 w-4 text-red-500"},He=e("path",{"fill-rule":"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z","clip-rule":"evenodd"},null,-1),De={class:"mr-2 text-xs italic text-neutral-500"},Ie=["src","alt"],Pe={key:0,class:"mx-1 text-[9px] uppercase"},qe=["src","alt"],Ue={key:0,class:"mx-1 text-[9px] uppercase"},Je={class:""},Qe={__name:"Message",props:{room:Object,message:Object},setup(t){const n=t,d=f(!1),m=f(!1),a=j().props.auth.user,b=n.room.moderators.find(v=>v.id===a.id),h=j().props.publicModerators.find(v=>v.id===a.id),g=()=>{m.value=!0,axios.post(`/rooms/${n.room.id}/message/${n.message.id}/report`).then(v=>{m.value=!1})};return(v,w)=>(o(),i("div",Ae,[r(j)().props.publicModerators.find(s=>s.id===t.message.user.id)?_("",!0):(o(),i("div",{key:0,class:B(["absolute top-0 right-0 items-center bg-neutral-800 py-1 px-2 group-hover:flex",t.message.reports<0?"flex":"hidden"])},[m.value?(o(),i("div",Fe,ze)):(o(),i("button",{key:1,onClick:g,class:"flex items-center text-xs"},[e("span",Ee,l(t.message.reports),1),(o(),i("svg",Ne,[e("title",null,l(v.__("Report this message")),1),He]))]))],2)),e("time",De,l(t.message.time),1),r(b)||r(h)?(o(),i("button",{key:1,onClick:w[0]||(w[0]=s=>d.value=!0),class:B(["mr-1 flex items-center",t.room.moderators.find(s=>s.id===t.message.user.id)?"text-purple-500":"text-neutral-400"])},[e("img",{src:t.message.user.photo,alt:t.message.user.name,class:"mr-1 h-7 w-7 rounded-full"},null,8,Ie),y(" "+l(t.message.user.name)+" ",1),t.message.user.team?(o(),i("sup",Pe,"["+l(t.message.user.team.name)+"]",1)):_("",!0),y(" : ")],2)):(o(),i("span",{key:2,class:B(["mr-1 flex items-center",t.room.moderators.find(s=>s.id===t.message.user.id)?"text-purple-500":"text-neutral-400"])},[e("img",{src:t.message.user.photo,alt:t.message.user.name,class:"mr-1 h-7 w-7 rounded-full"},null,8,qe),y(" "+l(t.message.user.name)+" ",1),t.message.user.team?(o(),i("sup",Ue,"["+l(t.message.user.team.name)+"]",1)):_("",!0),y(" : ")],2)),e("span",Je,l(t.message.body),1),d.value?(o(),C(Re,{key:3,message:t.message,room:t.room,onClose:w[1]||(w[1]=s=>d.value=!1)},null,8,["message","room"])):_("",!0)]))}},Xe={class:"flex items-center pl-4 text-xl font-bold"},Ge=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})],-1),Ke={class:"p-4"},We={class:"mt-8 flex justify-end"},Ye={__name:"AlertModeratorsModal",props:{room:Object},emits:["close","reported"],setup(t,{emit:n}){const d=t,m=f(!1),a=Q({message:""}),b=()=>{a.post(`/rooms/${d.room.id}/alert`,{preserveScroll:!0,preserveState:!0,onSuccess:()=>{n("reported"),n("close")}})};return(h,g)=>(o(),C(O,{show:m.value,onClose:g[2]||(g[2]=v=>h.$emit("close"))},{default:x(()=>[c(V,null,{header:x(()=>[e("h3",Xe,[Ge,y(" "+l(h.__("Alerting moderators")),1)])]),default:x(()=>[e("div",Ke,[c(z,null,{default:x(()=>[y("Attention, cette fonctionnalité n'est à utiliser qu'en cas de problème de respect des règles sur le chat ou d'une panne sur la partie.")]),_:1}),c(Z,{modelValue:r(a).message,"onUpdate:modelValue":g[0]||(g[0]=v=>r(a).message=v),error:r(a).errors.message,label:"Commentaire (facultatif)"},null,8,["modelValue","error"]),e("div",We,[e("button",{class:"btn-secondary mr-2",onClick:g[1]||(g[1]=v=>h.$emit("close"))},l(h.__("Close")),1),e("button",{class:"btn-danger",onClick:b},l(h.__("Alerting moderators")),1)])])]),_:1})]),_:1},8,["show"]))}},Ze={class:"flex h-full flex-col"},et={class:"flex justify-center items-center gap-2 px-2 py-4"},tt=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})],-1),st={key:1,class:"flex items-center text-green-500"},ot=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})],-1),nt={class:"flex w-full p-2"},lt=["onSubmit"],rt={type:"submit",class:"rounded-r bg-teal-600 p-2 text-neutral-100"},at={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},it=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"},null,-1),mt={__name:"Chat",props:{room:Object},setup(t){const n=t,d=`chat-room.${n.room.id}`,m=f(""),a=f(n.room.latest_messages);j().props.auth.user;const b=f(),h=f(null),g=f(null);R(()=>{Echo.private(d).listen("NewMessage",s=>{a.value.unshift(s.message),w()}).listen("MessageReported",s=>{a.value=a.value.map(p=>p.id===s.message.id?s.message:p)}).listen("MessageDeleted",s=>{a.value=a.value.filter(p=>p.id!=s.message.id)})}),A(()=>{Echo.leave(d)});const v=()=>{axios.post(`/rooms/${n.room.id}/message`,{body:m.value}).then(s=>{m.value=""})},w=()=>{let s=b.value;s.scrollTop=s.scrollHeight+1e3};return(s,p)=>(o(),i(S,null,[e("div",Ze,[e("div",et,[h.value?(o(),i("div",st,[ot,y(" "+l(s.__("Alert sent")),1)])):(o(),i("button",{key:0,class:"btn-secondary btn-sm bg-neutral-700",onClick:p[0]||(p[0]=M=>g.value=!0)},[tt,y(" "+l(s.__("Alerting moderators")),1)])),c(E,{url:t.room.url,class:"w-5 h-5"},null,8,["url"])]),e("div",{ref_key:"messenger",ref:b,class:"flex flex-1 flex-col-reverse overflow-y-scroll p-2"},[(o(!0),i(S,null,F(a.value,M=>(o(),C(Qe,{key:M.id,message:M,room:t.room},null,8,["message","room"]))),128))],512),e("div",nt,[e("form",{onSubmit:X(v,["prevent"]),class:"flex w-full"},[c(ee,{modelValue:m.value,"onUpdate:modelValue":p[1]||(p[1]=M=>m.value=M),autocomplete:"off",inputClass:"rounded-r-none border-0",class:"flex-grow"},null,8,["modelValue"]),e("button",rt,[(o(),i("svg",at,[e("title",null,l(s.__("Send")),1),it]))])],40,lt)])]),c(Ye,{room:t.room,show:g.value,onReported:p[2]||(p[2]=M=>h.value=!0),onClose:p[3]||(p[3]=M=>g.value=!1)},null,8,["room","show"])],64))}},ut={key:0,class:"flex h-full w-full items-center justify-center"},dt={key:0,class:"h-full md:flex"},ct={class:"relative flex-1 overflow-y-auto p-4 md:px-12 md:py-8","scroll-region":""},ht={class:"mb-4 flex items-center"},ft={class:"mr-2 text-xl font-bold"},vt={class:"font-bold"},pt=e("br",null,null,-1),gt={class:"mb-4 md:mb-8"},_t={class:"grid md:grid-cols-2 md:gap-8"},wt={class:"flex items-center flex-col lg:flex-row lg:justify-between gap-4 text-sm"},$t={class:"mx-auto flex flex-wrap items-center gap-4"},xt=e("span",{class:"uppercase text-neutral-500"},"Modos",-1),bt=["src","alt","title"],kt={key:0,class:"flex items-center gap-4"},yt=e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"mr-1 h-5 w-5"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.383a14.406 14.406 0 01-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 10-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})],-1),Mt={class:"uppercase text-neutral-500"},Ct=["title"],jt=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),Bt=[jt],St={key:0,class:"flex h-96 w-full flex-shrink-0 flex-col rounded-tl border-neutral-700 bg-neutral-800 transition-all duration-300 md:h-full md:w-1/5"},ms={__name:"Show",props:{room:Object},setup(t){const n=t,d=j().props.auth.user,m=`rooms.${n.room.id}`,a=f(null),b=f(!1),h=f(null),g=f(null),v=f(!1),w=f(!1),s=f(!0),p=f(0),M=f([]),T=f([]);R(()=>{Echo.join(m).here(u=>{h.value=u,N()}).joining(u=>{h.value.push(u)}).leaving(u=>{h.value=h.value.filter(k=>k.id!==u.id)}).error(u=>{console.error(u)})}),A(()=>{Echo.leave(m)});const N=()=>{axios.get(`/rooms/${n.room.id}/joined`).then(()=>{b.value=!0,H()})},H=()=>{Echo.channel(m).listen("RoundStarted",u=>{console.warn("Round started"),a.value=u.round,v.value=!1}).listen("RoundFinished",u=>{console.warn("Round finished"),a.value=u.round,M.value=u.users_podium,T.value=u.teams_podium,v.value=!0}).listen("TrackPlayed",u=>{a.value=u.round,n.room.value=u.room})};return(u,k)=>(o(),C(Ce,null,{default:x(()=>[b.value?_("",!0):(o(),i("div",ut,[c(W),e("h2",null,l(u.__("Loading"))+"...",1)])),c(L,{name:"slide-right"},{default:x(()=>[b.value?(o(),i("div",dt,[e("div",ct,[e("article",ht,[e("h2",ft,l(t.room.name),1),c(E,{url:t.room.url,class:"w-5"},null,8,["url"])]),!t.room.is_autostart&&(!a.value||!a.value.is_playing)&&!t.room.is_playing?(o(),C(z,{key:0,class:"bg-orange-400 text-orange-800"},{default:x(()=>[e("span",vt,l(u.__("This room is in manual start mode.")),1),pt,y(" "+l(u.__("The person responsible for the room (moderators) must be present to start the game.")),1)]),_:1})):_("",!0),e("div",gt,[c(se,{room:t.room,channel:m,"onTrack:currentTime":k[0]||(k[0]=$=>p.value=$)},null,8,["room"]),c(oe,{channel:m,currentTime:p.value,room:t.room},null,8,["currentTime","room"])]),e("div",_t,[c(ne,{class:"mb-4 md:mb-8",users:h.value,channel:m},null,8,["users"]),c(le,{class:"mb-4 md:mb-8",room:t.room,users:h.value,channel:m,data:g.value},null,8,["room","users","data"])]),t.room.moderators.find($=>r(d).id===$.id)?(o(),C(te,{key:1,room:t.room,round:a.value,channel:m,class:"mb-4"},null,8,["room","round"])):_("",!0),c(V,null,{default:x(()=>[e("div",wt,[e("div",null,[e("div",$t,[xt,(o(!0),i(S,null,F(t.room.moderators,$=>(o(),i("span",{class:B(["flex items-center",{"font-bold text-teal-500":h.value.find(D=>$.id===D.id)}])},[e("img",{src:$.photo,alt:$.name,title:$.name,class:"mr-1 h-8 w-8 rounded-full"},null,8,bt),y(" "+l($.name),1)],2))),256))])]),r(d)?(o(),i("div",kt,[e("button",{class:"btn-secondary bg-neutral-900 btn-sm",onClick:k[1]||(k[1]=$=>w.value=!0)},[yt,y(" "+l(u.__("Send a suggestion")),1)]),e("span",Mt,l(t.room.tracks_count)+" audios",1)])):_("",!0)])]),_:1}),r(d)&&t.room.is_chat_active?(o(),i("button",{key:2,class:"absolute right-0 top-5 hidden rounded-l-lg bg-neutral-800 p-2 md:block",onClick:k[2]||(k[2]=$=>s.value=!s.value),title:u.__("Hide/Show chatbox")},Bt,8,Ct)):_("",!0)]),r(d)&&s.value&&t.room.is_chat_active?(o(),i("div",St,[c(mt,{room:t.room},null,8,["room"])])):_("",!0)])):_("",!0)]),_:1}),a.value?(o(),C(re,{key:1,show:v.value,round:a.value,users_podium:M.value,teams_podium:T.value,onClose:k[3]||(k[3]=$=>v.value=!1)},null,8,["show","round","users_podium","teams_podium"])):_("",!0),r(d)?(o(),C(ae,{key:2,show:w.value,room:t.room,onClose:k[4]||(k[4]=$=>w.value=!1)},null,8,["show","room"])):_("",!0)]),_:1}))}};export{ms as default};

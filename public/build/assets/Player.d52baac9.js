import{h as t,k as _,G as E,o as s,b as o,t as v,M as w}from"./app.d9a699ed.js";const T={id:"player",class:"flex h-4 w-full items-center overflow-hidden rounded-t-lg bg-purple-200"},b={key:0,class:"text-red-500"},L={key:1,class:"flex h-4 w-full animate-pulse items-center justify-center rounded-t-lg bg-purple-500"},x={__name:"Player",props:{room:Object,channel:String},emits:["track:played","track:ended","track:paused","track:stopped"],setup(k,{emit:c}){const a=k,e=new Audio,h=t(null),r=t(!0),l=t(!1),u=t(null),d=t(0),i=t(!1);_(()=>{Echo.channel(a.channel).listen("TrackPlayed",n=>{console.log("Track played"),h.value=n.data.track,f()}),Echo.channel(a.channel).listen("TrackEnded",n=>{console.log("Track ended"),p()}),Echo.channel(a.channel).listen("TrackPaused",()=>{m()}),Echo.channel(a.channel).listen("TrackResumed",()=>{y()})}),E(()=>{l.value&&p(),Echo.leave(`rooms.${a.room.id}`)});const f=()=>{l.value&&p(),r.value=!0,l.value=!0,e.src=h.value.preview_url,e.addEventListener("error",()=>{u.value=e.error.message,l.value=!1}),e.addEventListener("canplaythrough",()=>{r.value=!1;let n=e.play();n!==void 0&&n.catch(function(g){console.error("Need to handle when the user come directly to a room.")})}),e.addEventListener("timeupdate",()=>{d.value=parseInt(100/a.room.track_duration*(e.currentTime+.25)),i.value=d.value>85}),e.addEventListener("ended",()=>{l.value=!1,r.value=!0,i.value=!1,c("track:ended",a.track)})},m=()=>{e.pause(),c("track:paused",a.track)},y=()=>{e.play()},p=()=>{i.value=!1,e.pause(),c("track:stopped",a.track)};return(n,g)=>(s(),o("div",T,[u.value?(s(),o("div",b,v(u.value),1)):r.value?(s(),o("div",L,v(n.__("Loading")),1)):(s(),o("div",{key:2,class:"shine h-4 rounded-r-lg bg-gradient-to-br from-purple-300 to-purple-400 transition-all duration-500 ease-linear",style:w("width:"+d.value+"%")},null,4))]))}};export{x as default};

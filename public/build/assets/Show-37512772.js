import{Q as I,o,c as i,a as c,w as $,b as e,t as r,u as n,X as P,r as q,g as _,R,F as B,J as j,k as f,h as C,d as y,I as U,N as J,f as S,P as Q,q as A,L as F,v as O,e as X}from"./app-d721267d.js";import{F as G}from"./LanguageSwitcher-882651fe.js";import"./isSymbol-00efd63c.js";import"./_defineProperty-2694e645.js";import{_ as K}from"./Navbar-e1fd621c.js";import{C as V}from"./Card-73e0c1e9.js";import{S as W}from"./Spinner-7167c342.js";import{_ as T}from"./Modal-50313139.js";import{_ as Y}from"./BanForm-53596b7d.js";import{T as z}from"./Tip-74f30155.js";import{_ as Z}from"./TextareaInput-7b68c5cb.js";import{_ as ee}from"./TextInput-09144107.js";import{_ as E}from"./Share-94827f12.js";import te from"./LoginForm-d640928f.js";import se from"./Controls-b88213f5.js";import oe from"./Player-45546925.js";import ne from"./UserInput-65ad6bd6.js";import le from"./Answers-1ccab3e9.js";import re from"./Ranking-01e073b4.js";import ae from"./FinishedRoundModal-a27cdc99.js";import ie from"./SendSuggestionModal-26d60c00.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./Dropdown-1979e914.js";import"./Icon-97e692a8.js";import"./throttle-815b75de.js";import"./debounce-c15f2e14.js";import"./SocialIcon-7b1795d7.js";import"./SelectInput-a8021202.js";import"./v4-cf522c50.js";import"./LoadingButton-c26c9090.js";import"./Socialite-cbdbdd91.js";import"./EditOptionsForm-c447490a.js";import"./CheckboxInput-7662c47b.js";import"./PodiumModal-1bfb142b.js";import"./Podium-6389fbc9.js";const me=["content"],ue=["content"],de=e("meta",{property:"og:type",content:"website"},null,-1),ce=["content"],he=["content"],fe=["content"],ve=e("meta",{name:"twitter:card",content:"summary_large_image"},null,-1),pe=e("meta",{property:"twitter:domain",content:"blinest.com"},null,-1),ge=["content"],_e=["content"],we=["content"],$e=["content"],xe={class:"text-neutral-200"},be=e("div",{id:"dropdown"},null,-1),ke={class:"md:flex md:flex-col"},ye={class:"md:flex md:h-screen md:flex-col"},Me={class:"md:flex md:flex-grow md:overflow-hidden"},Ce={key:0,class:"md:flex-1"},je={__name:"RoomLayout",setup(t){const l=I(()=>j().props.room);return(a,u)=>(o(),i(B,null,[c(n(P),null,{default:$(()=>[e("title",null,r(n(l).name),1),e("meta",{name:"description",content:n(l).description},null,8,me),e("meta",{property:"og:url",content:n(l).url},null,8,ue),de,e("meta",{property:"og:image",content:n(l).photo_src?n(l).photo_src:n(l).photo},null,8,ce),e("meta",{property:"og:title",content:n(l).name+" - Blinest.com"},null,8,he),e("meta",{property:"og:description",content:n(l).description},null,8,fe),ve,pe,e("meta",{property:"twitter:url",content:n(l).url},null,8,ge),e("meta",{name:"twitter:description",content:n(l).description},null,8,_e),e("meta",{name:"twitter:title",content:n(l).name+" - Blinest"},null,8,we),e("meta",{name:"twitter:image",content:n(l).photo_src?n(l).photo_src:n(l).photo},null,8,$e)]),_:1}),e("div",xe,[be,e("div",ke,[e("div",ye,[c(K),e("div",Me,[c(R,{name:"slide-right",appear:""},{default:$(()=>[a.$slots.default?(o(),i("div",Ce,[c(G),q(a.$slots,"default")])):_("",!0)]),_:3})])])])])],64))}},Be={class:"flex w-full items-center justify-between"},Se={class:"pr-2 text-sm italic"},Ve={class:"my-2 border-l px-4 py-2 font-mono text-neutral-400"},Te={class:"mr-1 text-xs"},Le=e("br",null,null,-1),Re={class:"my-4 flex items-center gap-4"},Ae={__name:"Moderation",props:{message:Object,room:Object},emits:["close"],setup(t,{emit:l}){const a=t,u=j().props.auth.user,m=a.room.moderators.find(s=>s.id===a.message.user.id),b=j().props.publicModerators.find(s=>s.id===u.id),h=f(!0),g=f(!1),v=()=>{axios.delete(`/moderation/messages/${a.message.id}`).then(s=>{w()})},w=()=>{l("close")};return(s,p)=>(o(),C(T,{show:h.value,onClose:w},{default:$(()=>[c(V,null,{header:$(()=>[e("div",Be,[e("h2",null,r(s.__("Moderation")),1),e("span",Se,r(t.message.user.name),1)])]),default:$(()=>[e("blockquote",Ve,[e("time",Te,r(t.message.time),1),Le,y(" "+r(t.message.body),1)]),e("div",Re,[e("button",{class:"btn-danger btn-sm",onClick:v},r(s.__("Delete message")),1),!n(m)&&n(b)?(o(),i("button",{key:0,class:"btn-danger btn-sm",onClick:p[0]||(p[0]=M=>g.value=!g.value)},r(s.__("Ban"))+" "+r(t.message.user.name),1)):_("",!0),e("button",{class:"btn-secondary btn-sm",onClick:w},r(s.__("Cancel")),1)]),U(c(Y,{user:t.message.user},null,8,["user"]),[[J,g.value]])]),_:1})]),_:1},8,["show"]))}},Fe={class:"group relative my-1 flex flex-wrap items-center text-sm hover:opacity-90"},Oe={key:0},ze=e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4 animate-spin"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})],-1),Ee=[ze],Ne={class:"mr-1 text-yellow-600"},He={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"h-4 w-4 text-red-500"},De=e("path",{"fill-rule":"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z","clip-rule":"evenodd"},null,-1),Ie={class:"mr-2 text-xs italic text-neutral-500"},Pe=["src","alt"],qe={key:0,class:"mx-1 text-[9px] uppercase"},Ue=["src","alt"],Je={key:0,class:"mx-1 text-[9px] uppercase"},Qe={class:""},Xe={__name:"Message",props:{room:Object,message:Object},setup(t){const l=t,a=f(!1),u=f(!1),m=j().props.auth.user,b=l.room.moderators.find(v=>v.id===m.id),h=j().props.publicModerators.find(v=>v.id===m.id),g=()=>{u.value=!0,axios.post(`/rooms/${l.room.id}/message/${l.message.id}/report`).then(v=>{u.value=!1})};return(v,w)=>(o(),i("div",Fe,[n(j)().props.publicModerators.find(s=>s.id===t.message.user.id)?_("",!0):(o(),i("div",{key:0,class:S(["absolute top-0 right-0 items-center bg-neutral-800 py-1 px-2 group-hover:flex",t.message.reports<0?"flex":"hidden"])},[u.value?(o(),i("div",Oe,Ee)):(o(),i("button",{key:1,onClick:g,class:"flex items-center text-xs"},[e("span",Ne,r(t.message.reports),1),(o(),i("svg",He,[e("title",null,r(v.__("Report this message")),1),De]))]))],2)),e("time",Ie,r(t.message.time),1),n(b)||n(h)?(o(),i("button",{key:1,onClick:w[0]||(w[0]=s=>a.value=!0),class:S(["mr-1 flex items-center",t.room.moderators.find(s=>s.id===t.message.user.id)?"text-purple-500":"text-neutral-400"])},[e("img",{src:t.message.user.photo,alt:t.message.user.name,class:"mr-1 h-7 w-7 rounded-full"},null,8,Pe),y(" "+r(t.message.user.name)+" ",1),t.message.user.team?(o(),i("sup",qe,"["+r(t.message.user.team.name)+"]",1)):_("",!0),y(" : ")],2)):(o(),i("span",{key:2,class:S(["mr-1 flex items-center",t.room.moderators.find(s=>s.id===t.message.user.id)?"text-purple-500":"text-neutral-400"])},[e("img",{src:t.message.user.photo,alt:t.message.user.name,class:"mr-1 h-7 w-7 rounded-full"},null,8,Ue),y(" "+r(t.message.user.name)+" ",1),t.message.user.team?(o(),i("sup",Je,"["+r(t.message.user.team.name)+"]",1)):_("",!0),y(" : ")],2)),e("span",Qe,r(t.message.body),1),a.value?(o(),C(Ae,{key:3,message:t.message,room:t.room,onClose:w[1]||(w[1]=s=>a.value=!1)},null,8,["message","room"])):_("",!0)]))}},Ge={class:"flex items-center pl-4 text-xl font-bold"},Ke=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})],-1),We={class:"p-4"},Ye={class:"mt-8 flex justify-end"},Ze={__name:"AlertModeratorsModal",props:{room:Object},emits:["close","reported"],setup(t,{emit:l}){const a=t,u=f(!1),m=Q({message:""}),b=()=>{m.post(`/rooms/${a.room.id}/alert`,{preserveScroll:!0,preserveState:!0,onSuccess:()=>{l("reported"),l("close")}})};return(h,g)=>(o(),C(T,{show:u.value,onClose:g[2]||(g[2]=v=>h.$emit("close"))},{default:$(()=>[c(V,null,{header:$(()=>[e("h3",Ge,[Ke,y(" "+r(h.__("Alerting moderators")),1)])]),default:$(()=>[e("div",We,[c(z,null,{default:$(()=>[y("Attention, cette fonctionnalité n'est à utiliser qu'en cas de problème de respect des règles sur le chat ou d'une panne sur la partie.")]),_:1}),c(Z,{modelValue:n(m).message,"onUpdate:modelValue":g[0]||(g[0]=v=>n(m).message=v),error:n(m).errors.message,label:"Commentaire (facultatif)"},null,8,["modelValue","error"]),e("div",Ye,[e("button",{class:"btn-secondary mr-2",onClick:g[1]||(g[1]=v=>h.$emit("close"))},r(h.__("Close")),1),e("button",{class:"btn-danger",onClick:b},r(h.__("Alerting moderators")),1)])])]),_:1})]),_:1},8,["show"]))}},et={class:"flex h-full flex-col"},tt={class:"flex justify-center items-center gap-2 px-2 py-4"},st=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})],-1),ot={key:1,class:"flex items-center text-green-500"},nt=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})],-1),lt={class:"flex w-full p-2"},rt=["onSubmit"],at={type:"submit",class:"rounded-r bg-teal-600 p-2 text-neutral-100"},it={xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},mt=e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"},null,-1),ut={__name:"Chat",props:{room:Object},setup(t){const l=t,a=`chat-room.${l.room.id}`,u=f(""),m=f(l.room.latest_messages);j().props.auth.user;const b=f(),h=f(null),g=f(null);A(()=>{Echo.private(a).listen("NewMessage",s=>{m.value.unshift(s.message),w()}).listen("MessageReported",s=>{m.value=m.value.map(p=>p.id===s.message.id?s.message:p)}).listen("MessageDeleted",s=>{m.value=m.value.filter(p=>p.id!=s.message.id)})}),F(()=>{Echo.leave(a)});const v=()=>{axios.post(`/rooms/${l.room.id}/message`,{body:u.value}).then(s=>{u.value=""})},w=()=>{let s=b.value;s.scrollTop=s.scrollHeight+1e3};return(s,p)=>(o(),i(B,null,[e("div",et,[e("div",tt,[h.value?(o(),i("div",ot,[nt,y(" "+r(s.__("Alert sent")),1)])):(o(),i("button",{key:0,class:"btn-secondary btn-sm bg-neutral-700",onClick:p[0]||(p[0]=M=>g.value=!0)},[st,y(" "+r(s.__("Alerting moderators")),1)])),c(E,{url:t.room.url,class:"w-5 h-5"},null,8,["url"])]),e("div",{ref_key:"messenger",ref:b,class:"flex flex-1 flex-col-reverse overflow-y-scroll p-2"},[(o(!0),i(B,null,O(m.value,M=>(o(),C(Xe,{key:M.id,message:M,room:t.room},null,8,["message","room"]))),128))],512),e("div",lt,[e("form",{onSubmit:X(v,["prevent"]),class:"flex w-full"},[c(ee,{modelValue:u.value,"onUpdate:modelValue":p[1]||(p[1]=M=>u.value=M),autocomplete:"off",inputClass:"rounded-r-none border-0",class:"flex-grow"},null,8,["modelValue"]),e("button",at,[(o(),i("svg",it,[e("title",null,r(s.__("Send")),1),mt]))])],40,rt)])]),c(Ze,{room:t.room,show:g.value,onReported:p[2]||(p[2]=M=>h.value=!0),onClose:p[3]||(p[3]=M=>g.value=!1)},null,8,["room","show"])],64))}},dt={key:1,class:"flex h-full w-full items-center justify-center"},ct={key:0,class:"h-full md:flex"},ht={class:"relative flex-1 overflow-y-auto p-4 md:px-12 md:py-8","scroll-region":""},ft={class:"mb-4 flex items-center"},vt={class:"mr-2 text-xl font-bold"},pt={class:"font-bold"},gt=e("br",null,null,-1),_t={key:1,class:"mb-4 md:mb-8"},wt={class:"grid md:grid-cols-2 md:gap-8"},$t={class:"flex items-center flex-col lg:flex-row lg:justify-between gap-4 text-sm"},xt={class:"mx-auto flex flex-wrap items-center gap-4"},bt=e("span",{class:"uppercase text-neutral-500"},"Modos",-1),kt=["src","alt","title"],yt={key:0,class:"flex items-center gap-4"},Mt=e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"mr-1 h-5 w-5"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.383a14.406 14.406 0 01-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 10-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})],-1),Ct={class:"uppercase text-neutral-500"},jt=["title"],Bt=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),St=[Bt],Vt={key:0,class:"flex h-96 w-full flex-shrink-0 flex-col rounded-tl border-neutral-700 bg-neutral-800 transition-all duration-300 md:h-full md:w-1/5"},cs={__name:"Show",props:{room:Object},setup(t){const l=t,a=j().props.auth.user,u=`rooms.${l.room.id}`,m=f(null),b=f(!1),h=f([]),g=f(null),v=f(!1),w=f(!1),s=f(!0),p=f(0),M=f([]),L=f([]);A(()=>{a&&Echo.join(u).here(d=>{h.value=d,N()}).joining(d=>{h.value.push(d)}).leaving(d=>{h.value=h.value.filter(k=>k.id!==d.id)}).error(d=>{console.error(d)})}),F(()=>{Echo.leave(u)});const N=()=>{axios.get(`/rooms/${l.room.id}/joined`).then(()=>{b.value=!0,H()})},H=()=>{Echo.channel(u).listen("RoundStarted",d=>{console.warn("Round started"),m.value=d.round,v.value=!1}).listen("RoundFinished",d=>{console.warn("Round finished"),m.value=d.round,M.value=d.users_podium,L.value=d.teams_podium,v.value=!0}).listen("TrackPlayed",d=>{m.value=d.round,l.room.value=d.room})};return(d,k)=>(o(),C(je,null,{default:$(()=>[n(a)?_("",!0):(o(),C(T,{key:0,show:!0},{default:$(()=>[c(te,{isFromModal:!0})]),_:1})),!b.value&&n(a)?(o(),i("div",dt,[c(W),e("h2",null,r(d.__("Loading"))+"...",1)])):_("",!0),c(R,{name:"slide-right"},{default:$(()=>[b.value||!n(a)?(o(),i("div",ct,[e("div",ht,[e("article",ft,[e("h2",vt,r(t.room.name),1),c(E,{url:t.room.url,class:"w-5"},null,8,["url"])]),!t.room.is_autostart&&(!m.value||!m.value.is_playing)&&!t.room.is_playing?(o(),C(z,{key:0,class:"bg-orange-400 text-orange-800"},{default:$(()=>[e("span",pt,r(d.__("This room is in manual start mode.")),1),gt,y(" "+r(d.__("The person responsible for the room (moderators) must be present to start the game.")),1)]),_:1})):_("",!0),n(a)?(o(),i("div",_t,[c(oe,{room:t.room,channel:u,"onTrack:currentTime":k[0]||(k[0]=x=>p.value=x)},null,8,["room"]),c(ne,{channel:u,currentTime:p.value,room:t.room},null,8,["currentTime","room"])])):_("",!0),e("div",wt,[c(le,{class:"mb-4 md:mb-8",users:h.value,channel:u},null,8,["users"]),c(re,{class:"mb-4 md:mb-8",room:t.room,users:h.value,channel:u,data:g.value},null,8,["room","users","data"])]),n(a)?(o(),i(B,{key:2},[t.room.moderators.find(x=>n(a).id===x.id)?(o(),C(se,{key:0,room:t.room,round:m.value,channel:u,class:"mb-4"},null,8,["room","round"])):_("",!0)],64)):_("",!0),c(V,null,{default:$(()=>[e("div",$t,[e("div",null,[e("div",xt,[bt,(o(!0),i(B,null,O(t.room.moderators,x=>(o(),i("span",{class:S(["flex items-center",{"font-bold text-teal-500":h.value.find(D=>x.id===D.id)}])},[e("img",{src:x.photo,alt:x.name,title:x.name,class:"mr-1 h-8 w-8 rounded-full"},null,8,kt),y(" "+r(x.name),1)],2))),256))])]),n(a)?(o(),i("div",yt,[e("button",{class:"btn-secondary bg-neutral-900 btn-sm",onClick:k[1]||(k[1]=x=>w.value=!0)},[Mt,y(" "+r(d.__("Send a suggestion")),1)]),e("span",Ct,r(t.room.tracks_count)+" audios",1)])):_("",!0)])]),_:1}),n(a)&&t.room.is_chat_active?(o(),i("button",{key:3,class:"absolute right-0 top-5 hidden rounded-l-lg bg-neutral-800 p-2 md:block",onClick:k[2]||(k[2]=x=>s.value=!s.value),title:d.__("Hide/Show chatbox")},St,8,jt)):_("",!0)]),n(a)&&s.value&&t.room.is_chat_active?(o(),i("div",Vt,[c(ut,{room:t.room},null,8,["room"])])):_("",!0)])):_("",!0)]),_:1}),m.value?(o(),C(ae,{key:2,show:v.value,round:m.value,users_podium:M.value,teams_podium:L.value,onClose:k[3]||(k[3]=x=>v.value=!1)},null,8,["show","round","users_podium","teams_podium"])):_("",!0),n(a)?(o(),C(ie,{key:3,show:w.value,room:t.room,onClose:k[4]||(k[4]=x=>w.value=!1)},null,8,["show","room"])):_("",!0)]),_:1}))}};export{cs as default};

import{g as t,i as y,E as _,o,b as u,t as k,G as E}from"./app.e47e5905.js";const T={id:"player",class:"flex h-4 w-full items-center overflow-hidden rounded-t-lg bg-purple-200"},b={key:0,class:"text-red-500"},w={key:1,class:"flex h-4 w-full animate-pulse items-center justify-center rounded-t-lg bg-purple-500"},P={__name:"Player",props:{room:Object,channel:String},emits:["track:played","track:ended","track:paused","track:stopped"],setup(f,{emit:c}){const a=f,e=new Audio,v=t(null),n=t(!0),l=t(!1),r=t(null),d=t(0),i=t(!1);y(()=>{Echo.channel(a.channel).listen("TrackPlayed",s=>{console.log("Track played"),v.value=s.track,h()}).listen("TrackEnded",s=>{console.log("Track ended"),p()}).listen("TrackPaused",()=>{g()}).listen("TrackResumed",()=>{m()})}),_(()=>{l.value&&p(),Echo.leave(a.channel)});const h=()=>{l.value&&p(),n.value=!0,r.value=null,l.value=!0,e.src=v.value.preview_url,e.addEventListener("error",()=>{r.value=e.error.message,l.value=!1}),e.addEventListener("canplaythrough",()=>{n.value=!1,e.play()}),e.addEventListener("timeupdate",()=>{d.value=parseInt(100/a.room.track_duration*(e.currentTime+.25)),i.value=d.value>85}),e.addEventListener("ended",()=>{l.value=!1,n.value=!0,i.value=!1,c("track:ended",a.track)})},g=()=>{e.pause(),c("track:paused",a.track)},m=()=>{e.play()},p=()=>{i.value=!1,e.pause(),c("track:stopped",a.track)};return(s,L)=>(o(),u("div",T,[r.value?(o(),u("div",b,k(r.value),1)):n.value?(o(),u("div",w,k(s.__("Loading")),1)):(o(),u("div",{key:2,class:"shine h-4 rounded-r-lg bg-gradient-to-br from-purple-300 to-purple-400 transition-all duration-500 ease-linear",style:E("width:"+d.value+"%")},null,4))]))}};export{P as default};
